# 1.4. Редактор Vim

Редактор Vim имеет три основных режима работы:

1. Командный режим: в этом режиме каждое нажатие клавиши воспринимается как команда для редактора, которая немедленно выполняется.

2. Режим вставки/замены: в этом режиме производится добавление и замещение символов в тексте.

3. Режим командной строки: в этом режиме пользователь вводит команды, которые отображаются на экране и выполняются.

Для запуска редактора Vim используйте команду:

vim [ключи] [файл]
При запуске указанного файла открывается для редактирования. Если файл не указан, открывается пустой файл, который можно сохранить позже. Некоторые ключи включают:

- +[номер]: перемещает курсор на указанную строку. Если номер не указан, курсор переместится на последнюю строку.
- m: запрещает запись файла на диск.
- R: открывает файл в режиме "Только для чтения".

По умолчанию Vim запускается в командном режиме. Чтобы перейти в режим командной строки, нажмите : (двоеточие), введите текстовую команду, затем нажмите Enter. Некоторые команды в режиме командной строки:

- :help: отображает справку. Для перемещения по гиперссылкам используйте Ctrl+] для перехода и Ctrl+o для возврата. Для выхода из справки введите команду :q.
- :q!: выйти без сохранения изменений.
- :q: выйти из Vim; если были внесены изменения, редактор предупредит об этом.
- :w [файл]: сохранить изменения в указанном файле.
- :wq: выйти из редактора с сохранением.

Для возвращения в командный режим нажмите ESC. Пустые строки обозначаются символом ~ в редакторе.

Чтобы переключиться в режим вставки, нажмите Insert, повторное нажатие переведет вас в режим замены. В нижней строке будет отображаться указание режима и текущая позиция курсора.

При работе с текстом в Vim используются понятия абзаца, строки и слова. Абзац - часть текста между двумя пустыми строками. Строка - часть текста, заканчивающаяся символом новой строки. Слово с точки зрения Vim может быть определено не так, как пользователь привык, например, строка abcd;efgh считается тремя словами.

Некоторые клавиши (Delete, Backspace, Home, End, стрелки и т. д.) могут вести себя по-разному в режиме замены/вставки. Помните, что большинство операций с текстом можно выполнить в командном режиме.


### Ход работы:

1. Запустите текстовый редактор Vim без параметров и ознакомьтесь с информацией, отображаемой в начальном окне.

2. Вызовите справочную систему редактора и изучите разделы, выделенные символами || или разным цветом. Перейдите к разделу содержания (Table of Contents First Steps in Vim Inserting Text) и прочтите информацию о вставке текста. После этого вернитесь в главное окно справки и вернитесь в редактор.

3. Переключитесь в режим вставки текста и наберите следующий текстовый фрагмент:

При установке системы по умолчанию регистрируется как минимум один пользователь - root (суперпользователь). Под этой учетной записью можно выполнить любые, в том числе и деструктивные действия, поэтому во многих дистрибутивах вход с правами root предназначен исключительно для администрирования и возможен только в режиме командной строки. Для обычной работы создается пользователь, имеющий стандартные разрешения.
4. Выйдите в командный режим. Попробуйте использовать клавиши-стрелки, Home, End, PgUp и PgDown. В случае удаления части текста, вернитесь в режим вставки и восстановите текст.

5. Отформатируйте документ так, чтобы каждое предложение стало отдельным абзацем.

6. Сохраните документ под именем text1 и продолжите его редактирование, заменив слово "root" на "суперпользователь". Сохраните изменения под именем text2, при этом продолжая работу над исходным документом text1. После этого закройте редактор.

7. Перезапустите Vim и перейдите сразу к последней строке файла text1.

**Необходимые сведения**

Кроме клавиши Insert для перехода в режим вставки/замены можно следующими клавишами (в командном режиме):

O - добавление текста в новой строке перед текущей;

o - добавление текста в новой строке после текущей;

I - добавление текста в начале текущей строки;

i - добавление текста перед курсором;

a - добавление текста после курсора;

A - добавление текста в конце текущей строки.

Перемещение по строке с помощью курсорных клавиш не очень удобно. Для быстрого перемещения по тексту используют следующие команды:

h и l - на одну позицию влево и вправо соответственно;

j и k - на следующую и предыдущую строку соответственно;

^ и $ - в начало и конец строки соответственно;

w и b - на слово вправо и влево соответственно;

[[ и ]] - в начало и конец текста соответственно;

H и L - в первую и последнюю строку экрана соответственно.

Команды редактирования текста:

x - удаление символа в позиции курсора;

dкоманда_перемещения - стирание от текущего положения курсора до нового;

u - отмена последнего действия;

dd - удаление текущей строки;

J - слияние текущей строки со следующей.

Команды перемещения и редактирования можно выполнять многократно: для этого перед самой командой набирается числовое значение, например:

2w - передвинуть курсор на два слова влево;

4J - слить четыре последующих строк в одну;

15x - удалить 15 символов после курсора;

2d3w - дважды повторить операцию удаления трех слов, то есть всего будет удалено 6 слов.

Для поиска текста используют команду /слово; / - повторить поиск слова далее по тексту.

Для замены слов в тексте используется команда

:[номер]s/строка1/строка2/[ключи],

где

номер задает диапазон строк, в которых производить замену. Задается в виде n,m (номера первой и последней строки диапазона), либо % (все строки);

строка1 и строка2 - что заменять и чем заменять соответственно;

ключи - модифицируют процесс замены. Ключ g (без дефиса) указывает на глобальную замену всех вхождений строка1 (по умолчанию, заменяется только первое вхождение); ключ с (без дефиса) включает режим запроса подтверждений (варианты ответов: y («да» для текущего), n («нет» для текущего), a («да» для всех последующих вхождений).

Для повторного вызова команды поиска или замены в командном режиме наберите / или :, курсорными клавишами перейдите на нужную команду.

**Ход работы**

1. Не используя курсорных клавиш, выполните следующие действия:
- перейдите на первую строку текста;
- добавьте в конец первой строки фразу Конец первой строки;
- используя одну команду удалите три слова перед курсором;
- перейдите на последнюю строку текста;
- удалите 12 первых символов строки;
- перейдите на вторую строку и удалите с помощью одной команды;
1. С помощью команды u восстановите текст до исходного состояния.
2. Осуществите последовательный поиск всех слов пользователь в тексте.
3. Произведите глобальную замену слова пользователь на обычный пользователь. Сохраните файл с именем text3.

**Необходимые сведения**

Команды копирования, вставки и перемещения фрагментов текста являются стандартными в любом редакторе. Скопированный или удаленный текст хранится в специальных областях памяти - *буферах данных*. Чаще всего используются три типа буферов:

1. *Неименованный буфер* (используется по умолчанию). В него помещается последний скопированный или удаленный текстовый фрагмент. В командах обозначается "" (две двойные кавычки).
2. *Буферы стирания*, обозначаемые числами "0, "1,…,"9 (двойные кавычки и число). В них автоматически заносятся стираемые элементы. В буфере "0 хранится последний стертый элемент, в буфере "1 - предпоследний и т. д. При очередном удалении содержимое буфера с номером "9 теряется безвозвратно.
3. Именованные буферы с именами "a-"z, "A-"Z. B них заносятся данные только в том случае, если пользователь явно указал их имя. Если указывается строчная буква, то фрагмент в буфере перезаписывается, если прописная - текст добавляется.

Если в командном режиме набрать символ " (начало команды работы с буферами данных), то в нижней строке редактора отобразится набираемая команда. После выполнения операции занесения фрагмента в буфер в нижней строке отобразится соответствующее сообщение.

Основные команды работы с буферами данных:

yкоманда_перемещения - занести указанный командой перемещения блок текста в неименованный буфер (нажатие курсорных стрелок клавиатуры НЕ ЯВЛЯЕТСЯ движением курсора);

bufferyкоманда_перемещения - занести указанный командой перемещения блок текста в именованный буфер buffer;

yy - занести текущую строку в неименованный буфер;

bufferyy - занести текущую строку в именованный буфер buffer;

p - вставить в текущую позицию содержимое неименованного буфера;

bufferp - вставить в текущую позицию содержимое именованного буфера buffer;

numberp - вставить в текущую позицию содержимое буфера стирания number.

Вместо команды p, которая вставляет фрагмент после курсора можно использовать команду P, которая вставляет перед курсором.

***Примеры команд:***

y3w - скопировать в неименованный буфер три слова после курсора;

"ay3w - скопировать в буфер a три слова после курсора

"a5yy - занести в неименованный буфер пять строк, начиная с текущей;

"ap - вставить в текущую позицию содержимое буфера a;

"6P - вставить фрагмент из буфера стирания номер шесть перед курсором.

